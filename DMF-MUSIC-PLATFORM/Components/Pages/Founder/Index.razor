@page "/founder"
@using System.Security.Claims
@using DMF_MUSIC_PLATFORM.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject HttpClient Http

<FounderGate>
    <div class="founder-dashboard">
        <div class="container-fluid py-4">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="founder-header">
                        <h1>?? Founder Control Center</h1>
                        <p class="lead text-muted">
                            Full platform access and system control
                        </p>
                    </div>
                </div>
            </div>

            <!-- Status Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="status-card">
                        <div class="status-icon platform">
                            <i class="bi bi-gear"></i>
                        </div>
                        <h5>Platform Status</h5>
                        <p class="status-value">@(platformStatus ?? "Loading...")</p>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="status-card">
                        <div class="status-icon users">
                            <i class="bi bi-people"></i>
                        </div>
                        <h5>Active Organizations</h5>
                        <p class="status-value">@activeOrgs</p>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="status-card">
                        <div class="status-icon releases">
                            <i class="bi bi-music-note-list"></i>
                        </div>
                        <h5>Total Releases</h5>
                        <p class="status-value">@totalReleases</p>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="status-card">
                        <div class="status-icon revenue">
                            <i class="bi bi-coin"></i>
                        </div>
                        <h5>Platform Revenue</h5>
                        <p class="status-value">$@platformRevenue</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row mb-4">
                <div class="col-12">
                    <h3>Quick Actions</h3>
                    <div class="action-grid">
                        <NavLink href="/founder/vault" class="action-card">
                            <div class="action-icon">??</div>
                            <h6>Master Vault</h6>
                            <p>Unreleased tracks & sensitive data</p>
                        </NavLink>

                        <NavLink href="/founder/ops" class="action-card">
                            <div class="action-icon">??</div>
                            <h6>System Operations</h6>
                            <p>Bots, services & platform control</p>
                        </NavLink>

                        <NavLink href="/founder/platform-settings" class="action-card">
                            <div class="action-icon">???</div>
                            <h6>Platform Settings</h6>
                            <p>Configuration & policies</p>
                        </NavLink>

                        <NavLink href="/founder/audit" class="action-card">
                            <div class="action-icon">??</div>
                            <h6>Audit Logs</h6>
                            <p>System activities & security events</p>
                        </NavLink>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="row">
                <div class="col-12">
                    <h3>Recent Activity</h3>
                    <div class="activity-table">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Action</th>
                                    <th>User</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (recentActivities.Count == 0)
                                {
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">Loading activity...</td>
                                    </tr>
                                }
                                else
                                {
                                    @foreach (var activity in recentActivities)
                                    {
                                        <tr>
                                            <td>@activity.Timestamp.ToString("g")</td>
                                            <td>@activity.Action</td>
                                            <td>@activity.User</td>
                                            <td><span class="badge bg-success">@activity.Status</span></td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</FounderGate>

@code {
    private string? platformStatus = "Operational";
    private int activeOrgs = 0;
    private int totalReleases = 0;
    private decimal platformRevenue = 0m;
    private List<ActivityLog> recentActivities = new();

    private class ActivityLog
    {
        public DateTime Timestamp { get; set; }
        public string Action { get; set; } = "";
        public string User { get; set; } = "";
        public string Status { get; set; } = "";
    }

    protected override async Task OnInitializedAsync()
    {
        // Load platform statistics
        await LoadPlatformStatus();
        await LoadRecentActivities();
    }

    private async Task LoadPlatformStatus()
    {
        try
        {
            // Call backend API to get platform status
            // var response = await Http.GetAsync("/api/founder/platform-status");
            // Parse and populate stats
            activeOrgs = 5; // Placeholder
            totalReleases = 248; // Placeholder
            platformRevenue = 12450.50m; // Placeholder
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading platform status: {ex.Message}");
        }
    }

    private async Task LoadRecentActivities()
    {
        try
        {
            // Call backend API to get audit logs
            recentActivities = new List<ActivityLog>
            {
                new ActivityLog { Timestamp = DateTime.Now.AddHours(-2), Action = "Organization Created", User = "org@example.com", Status = "Success" },
                new ActivityLog { Timestamp = DateTime.Now.AddHours(-4), Action = "Release Approved", User = "artist@example.com", Status = "Success" },
                new ActivityLog { Timestamp = DateTime.Now.AddHours(-6), Action = "Payout Processed", User = "finance@example.com", Status = "Success" }
            };
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading activities: {ex.Message}");
        }
    }
}

<style>
    .founder-dashboard {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: calc(100vh - 70px);
        padding-bottom: 40px;
    }

    .founder-header {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }

    .founder-header h1 {
        color: #333;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .status-card {
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .status-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .status-icon {
        font-size: 2rem;
        margin-bottom: 12px;
        display: inline-block;
        padding: 12px 16px;
        border-radius: 8px;
        color: white;
    }

    .status-icon.platform {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .status-icon.users {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .status-icon.releases {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .status-icon.revenue {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .status-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #333;
        margin: 8px 0 0 0;
    }

    .action-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .action-card {
        background: white;
        padding: 24px;
        border-radius: 8px;
        text-decoration: none;
        color: #333;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        border-left: 4px solid #ffc107;
    }

    .action-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        text-decoration: none;
        color: #333;
    }

    .action-icon {
        font-size: 2rem;
        margin-bottom: 12px;
    }

    .action-card h6 {
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
    }

    .action-card p {
        font-size: 0.85rem;
        color: #666;
        margin: 0;
    }

    .activity-table {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .table {
        margin-bottom: 0;
    }

    .table thead {
        background-color: #f8f9fa;
    }
</style>
