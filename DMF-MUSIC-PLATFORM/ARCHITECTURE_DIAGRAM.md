# ?? StreamGod Brain - Architecture Diagram

## System Overview

```
???????????????????????????????????????????????????????????????????????
?                        Du'ryia Engine Architecture                  ?
???????????????????????????????????????????????????????????????????????

????????????????????????????????????????????????????????????????????????
?                          FRONTEND (Lovable)                         ?
?                     https://dmf-music-platform.lovable.app          ?
????????????????????????????????????????????????????????????????????????
?                                                                      ?
?  ???????????????????????????????  ???????????????????????????????? ?
?  ?  CatalogHealthDashboard     ?  ? StreamGodRecommendations     ? ?
?  ?                             ?  ?                              ? ?
?  ? • Summary Cards             ?  ? • Top 10 Fix-First Items     ? ?
?  ? • Readiness Gauges          ?  ? • Current vs Potential       ? ?
?  ? • Tabbed Interface          ?  ? • Critical Issues            ? ?
?  ? • Live Refresh              ?  ? • Fix Time Estimates         ? ?
?  ???????????????????????????????  ???????????????????????????????? ?
?                 ?                                ?                  ?
?                 ??????????????????????????????????                  ?
?                                  ?                                  ?
?                    ??????????????????????????????                  ?
?                    ?  catalogService.ts         ?                  ?
?                    ?  (API Client)              ?                  ?
?                    ?  • Auth handling           ?                  ?
?                    ?  • Fetch calls             ?                  ?
?                    ?  • Error handling          ?                  ?
?                    ??????????????????????????????                  ?
?                                  ? HTTP Requests                   ?
???????????????????????????????????????????????????????????????????????
                                   ?
                    ???????????????????????????????
                    ?      HTTPS / CORS           ?
                    ?  Authorization: Bearer...  ?
                    ???????????????????????????????
                                   ?
???????????????????????????????????????????????????????????????????????
?                                  ?   BACKEND (.NET 10.0)            ?
?                    ??????????????????????????????                  ?
?                    ?  CatalogController         ?                  ?
?                    ?  /api/catalog/*            ?                  ?
?                    ?                            ?                  ?
?                    ? • GET /health              ?                  ?
?                    ? • GET /{id}/health         ?                  ?
?                    ? • GET /tracks/{id}/health  ?                  ?
?                    ? • GET /recommendations     ?                  ?
?                    ? • GET /health-check        ?                  ?
?                    ??????????????????????????????                  ?
?                                   ?                                ?
?                ???????????????????????????????????????             ?
?                ?                  ?                  ?             ?
?        ??????????????????  ?????????????????  ??????????????     ?
?        ? StreamGodBrain ?  ? StreamGodRec. ?  ? IMongoClient?     ?
?        ? Service        ?  ? Engine Service?  ?             ?     ?
?        ?                ?  ?                ?  ? Dependency  ?     ?
?        ? • Scoring      ?  ? • Top 10 List ?  ? Injection   ?     ?
?        ? • Analysis     ?  ? • Priorities  ?  ?             ?     ?
?        ? • Thresholds   ?  ? • Estimates   ?  ??????????????     ?
?        ??????????????????  ?????????????????        ?             ?
?                ?                  ?                 ?             ?
?        ??????????????????????????????????           ?             ?
?        ?   ReadinessModels              ?           ?             ?
?        ?   Data Structures              ?           ?             ?
?        ?                                ?           ?             ?
?        ? • CatalogHealthResponse        ?           ?             ?
?        ? • ReleaseReadinessResult       ?           ?             ?
?        ? • TrackReadinessResult         ?           ?             ?
?        ? • ReadinessIssue               ?           ?             ?
?        ? • CatalogHealthSummary         ?           ?             ?
?        ??????????????????????????????????           ?             ?
?                                                     ?             ?
?????????????????????????????????????????????????????????????????????
                                                      ?
                                 ???????????????????????????????????????
                                 ?    MongoDB Atlas (Cloud)             ?
                                 ?   dmf_music_platform.pfqrhc...       ?
                                 ?                                      ?
                                 ? Collections:                         ?
                                 ?  • releases (metadata + refs)        ?
                                 ?  • tracks (audio refs + credits)     ?
                                 ?                                      ?
                                 ????????????????????????????????????????
```

---

## Data Flow: Full Catalog Analysis

```
???????????????????????????????????????????????????????????????????????
?  User clicks "Refresh Analysis" button in Dashboard                 ?
???????????????????????????????????????????????????????????????????????
                         ?
                         ?
         ?????????????????????????????????????
         ? catalogService.getCatalogHealth() ?
         ?                                   ?
         ? Adds: Authorization Bearer token  ?
         ?????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? GET /api/catalog/health            ?
         ? (HTTPS to backend)                 ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? CatalogController.GetCatalogHealth ?
         ?                                    ?
         ? 1. Parse Authorization header      ?
         ? 2. Verify user is logged in        ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? MongoDB: Fetch all releases        ?
         ? var releases = await              ?
         ?   releasesCollection.Find()        ?
         ?   .ToListAsync()                   ?
         ?                                    ?
         ? Result: List<Release> (5 items)    ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? MongoDB: Fetch all tracks          ?
         ? var tracks = await                 ?
         ?   tracksCollection.Find()          ?
         ?   .ToListAsync()                   ?
         ?                                    ?
         ? Result: List<Track> (20 items)     ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? StreamGodBrain.ComputeCatalogHealthAsync()     ?
         ?                                    ?
         ? Loop through tracks:               ?
         ?  ?? Check ISRC (critical)          ?
         ?  ?? Check audio file (critical)    ?
         ?  ?? Check duration (quality)       ?
         ?  ?? Calculate score (0-100)        ?
         ?                                    ?
         ? Loop through releases:             ?
         ?  ?? Check UPC (critical)           ?
         ?  ?? Check title (critical)         ?
         ?  ?? Check tracks health            ?
         ?  ?? Calculate score (0-100)        ?
         ?                                    ?
         ? Result: CatalogHealthResponse      ?
         ?  {                                 ?
         ?    summary: {...},                 ?
         ?    releases: [...],                ?
         ?    tracks: [...]                   ?
         ?  }                                 ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? Return JSON to frontend            ?
         ? (200 OK + body)                    ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? catalogService receives JSON       ?
         ? Parse into CatalogHealthResponse   ?
         ? type                               ?
         ?                                    ?
         ? Result: Typed object               ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? React component updates state      ?
         ? setHealth(data)                    ?
         ??????????????????????????????????????
                          ?
                          ?
         ??????????????????????????????????????
         ? Dashboard re-renders with data:    ?
         ?                                    ?
         ? • Summary Cards show:              ?
         ?   - 5 total releases               ?
         ?   - 20 total tracks                ?
         ?   - 4 releases ready (80%)         ?
         ?   - 18 tracks ready (90%)          ?
         ?                                    ?
         ? • Gauges show:                     ?
         ?   - Release readiness: 87%         ?
         ?   - Track readiness: 92%           ?
         ?                                    ?
         ? • Tables show:                     ?
         ?   - Top 5 worst releases           ?
         ?   - Top 5 worst tracks             ?
         ?                                    ?
         ? • Overall status:                  ?
         ?   - ? Healthy                     ?
         ?   - Ready for distribution         ?
         ??????????????????????????????????????
```

---

## Scoring Logic: Single Track Example

```
Track: "Get Away" (ID: trk-123)

???????????????????????????????????????????
?  StreamGodBrain.ScoreTrack(track)       ?
?                                         ?
?  Starting score: 100                    ?
???????????????????????????????????????????
                 ?
     ???????????????????????????????????????????
     ?                        ?                ?
     ?                        ?                ?
????????????????    ????????????????  ????????????????
? CRITICAL     ?    ? WARNINGS     ?  ? INFO ONLY    ?
? CHECKS       ?    ? (Quality)    ?  ? (Metadata)   ?
????????????????    ????????????????  ????????????????
?                    ?                  ?
?? ISRC present?     ?? Duration set?  ?? Composer?
?  ? YES (USRC...)  ?  ? YES (240s)  ?  ? MISSING
?  Score stays 100   ?  Score stays100 ?  (OPTIONAL)
?                    ?                 ?
?? Audio file?       ?? Contributors? ?
?  ? YES (gs://...) ?  ? YES (2)    ?
?  Score stays 100   ?  Score stays100?
?                    ?                 ?
?? Release link?     ?? Genre?         ?? Metadata?
?  ? YES (rel-001)     ? YES (HipHop)   ? MINIMAL
?  Score stays 100      Score stays 100  (INFO)
?                                         ?
????????????????????????????????????????????
                     ?
                     ?
         Final Score: 100% ?
         Status: "Excellent - Ready for Distribution"
```

---

## Recommendation Priority Queue

```
???????????????????????????????????????????????????????????
?  StreamGodRecommendationEngine.GetFixFirstRecommendations()           ?
?                                                         ?
?  Input: CatalogHealthResponse with all scores          ?
?  Output: Top 10 lowest-scoring items                   ?
???????????????????????????????????????????????????????????
                 ?
                 ?
     ????????????????????????????????
     ?  Collect all items < 100     ?
     ?  (releases + tracks)          ?
     ?                              ?
     ?  Found 8 items needing work: ?
     ?   • rel-002: 55%             ?
     ?   • rel-003: 68%             ?
     ?   • trk-045: 45%             ?
     ?   • trk-089: 62%             ?
     ?   • ... (4 more)             ?
     ????????????????????????????????
                      ?
                      ?
     ????????????????????????????????
     ?  Sort by score (lowest first)?
     ?                              ?
     ?  Priority Order:             ?
     ?   1. trk-045: 45% (30 min)   ?
     ?   2. rel-002: 55% (25 min)   ?
     ?   3. trk-089: 62% (15 min)   ?
     ?   4. rel-003: 68% (20 min)   ?
     ?   5. ... (remaining)         ?
     ?                              ?
     ?  Total work: ~2 hours        ?
     ????????????????????????????????
                      ?
                      ?
     ????????????????????????????????
     ?  Return CatalogRecommendation?
     ?  Response with top 10        ?
     ?                              ?
     ?  {                           ?
     ?    summary: "Your catalog... ?
     ?    topFixFirst: [            ?
     ?      {...trk-045...},        ?
     ?      {...rel-002...},        ?
     ?      ...                     ?
     ?    ],                        ?
     ?    totalItemsNeedingWork: 8, ?
     ?    estimatedHours: 2         ?
     ?  }                           ?
     ????????????????????????????????
```

---

## Security Flow

```
????????????????????????????????????????????????????????????
?  Frontend: User logs in via Google OAuth                ?
?  (Google OAuth provider)                                 ?
????????????????????????????????????????????????????????????
                 ?
                 ?
     ????????????????????????????????
     ?  Backend receives Google     ?
     ?  OAuth callback              ?
     ?                              ?
     ?  GoogleSignInHandler creates ?
     ?  custom claims:              ?
     ?   • dmf:founder              ?
     ?   • dmf:roles                ?
     ?   • dmf:mfa_required         ?
     ?                              ?
     ?  Token issued to browser     ?
     ????????????????????????????????
                      ?
                      ?
     ????????????????????????????????
     ?  Browser stores token in:    ?
     ?  localStorage OR             ?
     ?  sessionStorage              ?
     ????????????????????????????????
                      ?
                      ?
     ????????????????????????????????
     ?  Each API call includes:     ?
     ?  Authorization: Bearer {jwt} ?
     ????????????????????????????????
                      ?
                      ?
     ????????????????????????????????
     ?  Backend verifies token:     ?
     ?                              ?
     ?  1. Check signature valid    ?
     ?  2. Check not expired        ?
     ?  3. Check user authenticated ?
     ?  4. Extract claims           ?
     ?                              ?
     ?  If all valid ? Process      ?
     ?  If invalid ? 401 Error      ?
     ????????????????????????????????
```

---

## Database Schema (MongoDB)

```
????????????????????????????????????
?  dmf_music_platform (Database)   ?
????????????????????????????????????
                 ?
    ???????????????????????????
    ?                         ?
    ?                         ?
???????????????????  ??????????????????
?  releases       ?  ?  tracks        ?
?  (Collection)   ?  ?  (Collection)  ?
???????????????????  ??????????????????
? _id: ObjectId   ?  ? _id: ObjectId  ?
? id: string      ?  ? id: string     ?
? upc: string?    ?  ? isrc: string?  ?
? title: string   ?  ? title: string  ?
? artist_id: str  ?  ? release_id: str?
? genre: string?  ?  ? duration: int? ?
? date: date?     ?  ? audio_ref: str??
? cover_art: str? ?  ? contributors: []
? metadata: {}    ?  ? metadata: {}   ?
? created_at: dt  ?  ? created_at: dt ?
???????????????????  ??????????????????
     ?                    ?
     ? Links to:          ?
     ??????????????????????
         Analyzed by
        StreamGodBrain
            ?
            ?
     ????????????????????
     ? CatalogHealth    ?
     ? Response         ?
     ?                  ?
     ? Scores: 0-100    ?
     ? Issues: []       ?
     ? Ready: bool      ?
     ????????????????????
```

---

## Authentication Flow

```
START: User visits frontend
  ?
  ?? NOT logged in?
  ?  ?? Redirect to Google OAuth
  ?     ?
  ?     ?? User logs in with Google
  ?     ?
  ?     ?? Backend receives callback
  ?        ?? Create custom claims
  ?           ?? Issue JWT token
  ?
  ?? Token stored in browser
  ?
  ?? User can now access catalog endpoints
     ?
     ?? Each request: "Authorization: Bearer {token}"
     ?
     ?? Backend validates:
        ?? Token signature valid? ?
        ?? Not expired? ?
        ?? User authenticated? ?
        ?
        ?? Process request ? Return data
```

---

This architecture ensures:
? **Security** - Google OAuth + JWT tokens
? **Performance** - MongoDB queries cached/optimized
? **Scalability** - Stateless backend services
? **Real-time** - Fresh data on each refresh
? **Reliability** - Error handling at each layer
? **Maintainability** - Clear separation of concerns
