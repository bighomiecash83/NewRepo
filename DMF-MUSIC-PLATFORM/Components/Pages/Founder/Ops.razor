@page "/founder/ops"
@using System.Security.Claims
@using DMF_MUSIC_PLATFORM.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider

<FounderGate>
    <div class="ops-container">
        <div class="container-fluid py-4">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="ops-header">
                        <h1>?? System Operations</h1>
                        <p class="lead text-muted">Platform services, bots, and infrastructure control</p>
                    </div>
                </div>
            </div>

            <!-- System Health Cards -->
            <div class="row mb-4">
                <div class="col-12">
                    <h3>System Health</h3>
                    <div class="health-grid">
                        <div class="health-card healthy">
                            <div class="health-indicator healthy-indicator"></div>
                            <h6>API Server</h6>
                            <p class="status">Healthy</p>
                            <p class="uptime">Uptime: 99.9%</p>
                        </div>
                        <div class="health-card healthy">
                            <div class="health-indicator healthy-indicator"></div>
                            <h6>Database</h6>
                            <p class="status">Healthy</p>
                            <p class="uptime">Response: 12ms</p>
                        </div>
                        <div class="health-card healthy">
                            <div class="health-indicator healthy-indicator"></div>
                            <h6>Message Queue</h6>
                            <p class="status">Healthy</p>
                            <p class="uptime">Messages: 2.4k/s</p>
                        </div>
                        <div class="health-card healthy">
                            <div class="health-indicator healthy-indicator"></div>
                            <h6>Storage</h6>
                            <p class="status">Healthy</p>
                            <p class="uptime">Usage: 67%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services & Bots -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="section-card">
                        <h3>Background Services</h3>
                        <div class="service-list">
                            <div class="service-item running">
                                <div class="service-info">
                                    <h6>Distribution Engine</h6>
                                    <p>Handles music distribution</p>
                                    <span class="badge bg-success">Running</span>
                                </div>
                                <div class="service-actions">
                                    <button class="btn btn-sm btn-warning">Stop</button>
                                    <button class="btn btn-sm btn-info">Restart</button>
                                </div>
                            </div>
                            <div class="service-item running">
                                <div class="service-info">
                                    <h6>Royalty Calculator</h6>
                                    <p>Processes royalty payments</p>
                                    <span class="badge bg-success">Running</span>
                                </div>
                                <div class="service-actions">
                                    <button class="btn btn-sm btn-warning">Stop</button>
                                    <button class="btn btn-sm btn-info">Restart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="section-card">
                        <h3>Active Bots</h3>
                        <div class="bot-list">
                            <div class="bot-item active">
                                <div class="bot-info">
                                    <h6>Auto-Distributor Bot</h6>
                                    <p>Auto-distributes ready releases</p>
                                    <span class="badge bg-success">Active</span>
                                </div>
                                <div class="bot-actions">
                                    <button class="btn btn-sm btn-info">Disable</button>
                                    <button class="btn btn-sm btn-secondary">Logs</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="section-card">
                        <h3>System Logs</h3>
                        <div class="log-filters">
                            <button class="btn btn-sm btn-primary" @onclick="() => OnFilterAll()">All</button>
                            <button class="btn btn-sm btn-outline-danger" @onclick="() => OnFilterError()">Errors</button>
                            <button class="btn btn-sm btn-outline-warning" @onclick="() => OnFilterWarning()">Warnings</button>
                            <button class="btn btn-sm btn-outline-info" @onclick="() => OnFilterInfo()">Info</button>
                        </div>
                        <div class="log-output">
                            <div class="log-entry info">
                                <span class="timestamp">14:32:15</span>
                                <span class="level">INFO</span>
                                <span class="message">Distribution Engine: 145 releases queued</span>
                            </div>
                            <div class="log-entry info">
                                <span class="timestamp">14:30:22</span>
                                <span class="level">INFO</span>
                                <span class="message">Royalty Calculator: Monthly aggregation completed</span>
                            </div>
                            <div class="log-entry warning">
                                <span class="timestamp">14:28:11</span>
                                <span class="level">WARNING</span>
                                <span class="message">Database: Slow query detected (2.5s elapsed)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Maintenance -->
            <div class="row">
                <div class="col-12">
                    <div class="section-card">
                        <h3>Maintenance & Admin</h3>
                        <div class="maintenance-grid">
                            <div class="action-group">
                                <h6>Database</h6>
                                <button class="btn btn-outline-secondary w-100">Optimize Tables</button>
                                <button class="btn btn-outline-secondary w-100">Backup Now</button>
                            </div>
                            <div class="action-group">
                                <h6>Cache</h6>
                                <button class="btn btn-outline-secondary w-100">Clear All Cache</button>
                                <button class="btn btn-outline-secondary w-100">Rebuild Cache</button>
                            </div>
                            <div class="action-group">
                                <h6>Platform</h6>
                                <button class="btn btn-outline-warning w-100">Maintenance Mode</button>
                                <button class="btn btn-outline-danger w-100">Request Restart</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</FounderGate>

@code {
    private void OnFilterAll() { }
    private void OnFilterError() { }
    private void OnFilterWarning() { }
    private void OnFilterInfo() { }
}

<style>
    .ops-container {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        min-height: calc(100vh - 70px);
        padding-bottom: 40px;
    }

    .ops-header {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        margin-bottom: 20px;
    }

    .ops-header h1 {
        color: #1e3c72;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .section-card {
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .health-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .health-card {
        padding: 15px;
        border-radius: 6px;
        background: #f8f9fa;
        border-left: 4px solid #dc3545;
    }

    .health-card.healthy {
        border-left-color: #28a745;
    }

    .health-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 6px;
        background: #dc3545;
    }

    .health-card.healthy .healthy-indicator {
        background: #28a745;
    }

    .health-card h6 {
        margin: 8px 0 4px 0;
        color: #333;
        font-weight: 600;
    }

    .health-card .status {
        font-weight: 600;
        font-size: 0.85rem;
        margin: 2px 0;
    }

    .health-card .uptime {
        font-size: 0.75rem;
        color: #666;
        margin: 0;
    }

    .service-list,
    .bot-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
    }

    .service-item,
    .bot-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #ddd;
    }

    .service-item.running,
    .bot-item.active {
        border-left-color: #28a745;
        background: #f0fff4;
    }

    .service-info,
    .bot-info {
        flex: 1;
    }

    .service-info h6,
    .bot-info h6 {
        margin: 0 0 4px 0;
        color: #333;
        font-weight: 600;
    }

    .service-info p,
    .bot-info p {
        font-size: 0.8rem;
        color: #666;
        margin: 0;
    }

    .service-actions,
    .bot-actions {
        display: flex;
        gap: 6px;
        margin-left: 10px;
    }

    .log-filters {
        display: flex;
        gap: 8px;
        margin: 15px 0;
        flex-wrap: wrap;
    }

    .log-output {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 12px;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 0.8rem;
        max-height: 250px;
        overflow-y: auto;
    }

    .log-entry {
        margin: 4px 0;
        display: grid;
        grid-template-columns: 70px 50px 1fr;
        gap: 10px;
    }

    .log-entry.error {
        color: #f48771;
    }

    .log-entry.warning {
        color: #dcdcaa;
    }

    .log-entry.info {
        color: #9cdcfe;
    }

    .timestamp {
        color: #858585;
    }

    .level {
        font-weight: bold;
    }

    .maintenance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .action-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .action-group h6 {
        margin: 0 0 8px 0;
        color: #333;
        font-weight: 600;
    }

    .w-100 {
        width: 100%;
    }
</style>
